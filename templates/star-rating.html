{# Inserts the image template for the individual stars #}
{% macro generate_star_template() %}
  <svg id="rating-template" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 25">
    <defs>
      <linearGradient id="star-half-gradient">
        <stop offset="0%" class="star-stop-fill"></stop>
        <stop offset="50%" class="star-stop-fill"></stop>
        <stop offset="50%" class="star-stop-empty"></stop>
      </linearGradient>
    </defs>
    <symbol id="star-icon" viewBox="0 0 25 25">
      <polygon points="12.5 18.5 5.75 23.5 8.5 15.25 1.5 10.0 10.0 10.0
        12.5 1.75 15.0 10.0 23.5 10.0 16.75 15.25 19.25 23.75 12.5 18.5"/>
    </symbol>
  </svg>
{% endmacro %}

{# Calculates the rating from a list of votes.
   This is a fairly naive formula, a better weighting may be possible.
   It may also be better to move this calculation to the python side. #}
{% macro calculate_rating(rating) %}
  {% set cumulative = rating[0] + rating[1] * 2 + rating[2] * 3 + rating[3] * 4 + rating[4] * 5 %}
  {% set weight =  rating[0] + rating[1] + rating[2] + rating[3] + rating[4] %}
  {% if (weight > 0) and (cumulative > 0) %}
    {{ cumulative / weight }}
  {% else %}
    {{ 0 }}
  {% endif %}
{% endmacro %}

{# Returns the current star's required check state #}
{% macro star_checked(n) %}
  {% if n > 0.25 %}
    {% if n < 0.75 %}
      class="check-half"
    {% else %}
      class="checked"
    {% endif %}
  {% endif %}
{% endmacro %}

{# Generates a static star rating element #}
{% macro generate_static_star_rating(rating) %}
  <ul class="star-rating">
    {% for i in [rating,rating-1,rating-2,rating-3,rating-4] %}
      <li {{ star_checked(i) }}><svg><use href="#star-icon"/></svg></li>
    {% endfor %}
  </ul>
{% endmacro %}
